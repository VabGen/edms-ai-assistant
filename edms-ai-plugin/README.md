# EDMS AI Assistant Chrome Plugin

Chrome плагин для интеграции AI ассистента с веб-приложением EDMS.

## Возможности

- Автоматическое обнаружение страниц с документами по URL `/document-form/*`
- Чат-интерфейс с AI ассистентом
- **Голосовой ввод** с распознаванием русской речи (Google Speech API)
- Поддержка нескольких чатов с историей
- Отображение результатов выполнения инструментов
- Современный адаптивный интерфейс
- Анимации загрузки

## Установка

1. Откройте Chrome и перейдите в `chrome://extensions/`
2. Включите "Режим разработчика" в правом верхнем углу
3. Нажмите "Загрузить распакованное расширение"
4. Выберите папку `src/main/chrome-plugin`
5. Плагин будет установлен и активирован

## Использование

1. Откройте страницу с документом (URL содержит `/document-form/`)
2. В правом нижнем углу появится кнопка чата
3. Нажмите на кнопку, чтобы открыть чат
4. Введите сообщение и нажмите Enter или кнопку отправки
5. **Для голосового ввода**: нажмите на кнопку микрофона и произнесите сообщение
6. Используйте кнопку "+" для создания нового чата
7. Используйте кнопку списка для переключения между чатами

## Голосовой ввод

- Поддерживается распознавание русской речи
- Нажмите на кнопку микрофона для начала записи
- Кнопка будет красной и пульсировать во время записи
- Говорите четко и не слишком быстро
- Нажмите кнопку еще раз или просто перестаньте говорить для завершения
- Требуется разрешение на доступ к микрофону

## Генерация заголовка с помощью ИИ

- Кнопка волшебной палочки автоматически появляется рядом с полем "Заголовок" на странице документа
- При нажатии отправляется запрос к ИИ для генерации краткого заголовка документа
- Сгенерированный заголовок автоматически вставляется в поле ввода
- Использует тот же контекст и данные документа, что и основной чат

### Отладка кнопки волшебной палочки

Если кнопка не появляется или появляется в неправильном месте:

1. Откройте консоль разработчика (F12)
2. Выполните команду: `window.edmsContentScript.debugMagicWandButton()`
3. Проанализируйте вывод в консоли - он покажет все найденные поля и их характеристики
4. Убедитесь, что поле "Заголовок" не имеет атрибута `readonly`
5. Проверьте, что вы находитесь на странице с document ID в URL

## Конфигурация

По умолчанию плагин подключается к серверу на `http://localhost:8080`.
Для изменения адреса сервера отредактируйте переменную `serverUrl` в файле `popup.js`.

## Структура файлов

- `manifest.json` - конфигурация плагина
- `popup.html` - интерфейс чата
- `popup.js` - логика чата
- `content.js` - скрипт для интеграции с веб-страницами
- `styles.css` - стили интерфейса
- `README.md` - документация

## API

Плагин отправляет запросы на следующие endpoints:

### `/chat` - основной чат

```json
{
  "message": "Текст сообщения",
  "chatId": "уникальный_id_чата",
  "documentId": "id_документа_из_url",
  "token": "токен_пользователя_из_localStorage"
}
```

### `/short-summary` - генерация заголовка

```json
{
  "documentId": "id_документа_из_url",
  "token": "токен_пользователя_из_localStorage",
  "domain": "домен_текущего_сайта"
}
```

**Важно:** Плагин автоматически извлекает токен из `localStorage` текущего домена веб-приложения по ключу `token`. Убедитесь, что ваше веб-приложение сохраняет токен пользователя в localStorage.

Ожидаемый ответ:

```json
{
  "message": "Ответ ассистента",
  "toolsExecutionResult": {
    "имя_инструмента": [
      {
        "success": true,
        "errorMessage": null
      }
    ]
  }
}
```
